
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Clone Firestore PROD -> DEV</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 40px;
    background: #f5f5f5;
  }
  h1 { color: #004aad; }
  button {
    padding: 12px 20px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    background: #004aad;
    color: white;
  }
  pre {
    background: #111;
    color: #0f0;
    padding: 16px;
    margin-top: 20px;
    height: 300px;
    overflow: auto;
    font-size: 13px;
  }
</style>
</head>
<body>

<h1>Clone Firestore PROD -> DEV</h1>
<p>Cette page copie <strong>accueilcs</strong> vers <strong>cismic-dev</strong>.</p>

<button id="runBtn">? Cloner PROD -> DEV</button>

<pre id="log"></pre>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

<script>
// ? CONFIG FIREBASE (la même que ton projet)
const firebaseConfig = {
  apiKey: "AIzaSyDlXhONTei5-T0t1XrvQ1RC_gCcih4A7T4",
  authDomain: "accueil-cs.firebaseapp.com",
  projectId: "accueil-cs",
  storageBucket: "accueil-cs.firebasestorage.app",
  messagingSenderId: "292270758652",
  appId: "1:292270758652:web:f6b56f208e5c4b374fd579",
  measurementId: "G-2FB4N537JW"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const logEl = document.getElementById("log");

function log(msg){
  logEl.textContent += msg + "\n";
  logEl.scrollTop = logEl.scrollHeight;
}

// ? Auth anonyme GARANTIE
async function ensureAnonAuth(){
  if (firebase.auth().currentUser) return;
  await firebase.auth().signInAnonymously();
  log("? Auth anonyme OK");
}

// ? Clone PROD -> DEV
async function cloneCollection(){
  await ensureAnonAuth();

  //const src = db.collection("accueilcs");
  //const dst = db.collection("cismic-dev");
   const dst = db.collection("accueilcs");
   const src = db.collection("cismic-dev");
  
  log("? Lecture PROD...");
  const snap = await src.get();
  log(`? ${snap.size} documents trouvés`);

  let count = 0;

  for (const doc of snap.docs) {
    await dst.doc(doc.id).set(doc.data());
    count++;
    if (count % 50 === 0) {
      log(`? ${count} documents copiés`);
    }
  }

  log(`? TERMINÉ : ${count} documents copiés`);
}

document.getElementById("runBtn").onclick = async () => {
  logEl.textContent = "";
  try {
    await cloneCollection();
  } catch (e) {
    console.error(e);
    log("? ERREUR : " + e.message);
  }
};
</script>

</body>
</html>
