<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico" type="image/x-icon">
<title>Connexion ‚Äî CISMIC</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');
* { box-sizing:border-box; font-family:'Inter',sans-serif; margin:0; padding:0; }
body {
  background: linear-gradient(135deg,#004aad,#d32f2f);
  display:flex; justify-content:center; align-items:center;
  height:100vh; color:#fff;
}
.login-box {
  background:#ffffffee; color:#222;
  border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.3);
  padding:40px 50px; width:100%; max-width:420px; text-align:center;
}
.login-box img { height:100px; margin-bottom:15px; }
.login-box h2 { font-size:24px; color:#004aad; margin-bottom:20px; font-weight:700; }
.login-box input, select {
  width:100%; padding:12px; margin:8px 0;
  border:1px solid #ccc; border-radius:8px; font-size:15px;
}
.login-box button {
  width:100%; padding:12px; background:#d32f2f;
  color:#fff; border:none; border-radius:8px; font-size:16px;
  font-weight:600; cursor:pointer;
}
.login-box button:hover { background:#b71c1c; }
.muted { font-size:13px; color:#555; margin-top:10px; }
.field-label { text-align:left; font-size:14px; font-weight:600; color:#004aad; margin-top:4px; }
.muted a { color:#004aad; text-decoration:underline; cursor:pointer; }
</style>
</head>

<body>

<div class="login-box">
  <img src="https://www.sdis30.fr/PublishingImages/Pages/SAPEUR-POMPIER-VOLONTAIRE/Logo%20Sdis%2030%202017.png" alt="Logo SDIS 30">
  <h2>Connexion ‚Äî CISMIC</h2>

  <input id="matricule" type="text" placeholder="Matricule" autocomplete="username">

  <div id="cis-container" style="display:none;">
    <div class="field-label">CIS</div>
    <select id="cisSelect"></select>
  </div>

  <input id="password" type="password" placeholder="Mot de passe" autocomplete="current-password">
  <button onclick="login()">Se connecter</button>

  <p class="muted">Mot de passe provisoire : <code>temp&lt;matricule&gt;</code></p>
  <p class="muted"><a onclick="forgotWithQuestion(event)">Mot de passe oubli√© ? R√©pondre √† ma question</a></p>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>

<script>
/* üî• INITIALISATION FIREBASE ‚Äî STRICTEMENT N√âCESSAIRE */
const firebaseConfig = {
  apiKey: "AIzaSyD1IxHONTei5-T0t1XrvQ1RC_gCcih4A7T4",
  authDomain: "accueil-cs.firebaseapp.com",
  projectId: "accueil-cs",
  storageBucket: "accueil-cs.firebasestorage.app",
  messagingSenderId: "292270758652",
  appId: "1:292270758652:web:f6b56f208e5c4b374fd579"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
</script>

<script src="cloud-storage.js"></script>

<script>
const INDEX_PATH = "index.html";

/* üîê Firebase Auth anonyme */
let __anonAuthReady = false;
async function ensureAnonymousAuth(){
  if(__anonAuthReady) return;
  if(!firebase.auth().currentUser){
    await firebase.auth().signInAnonymously();
  }
  __anonAuthReady = true;
}

/* ====== LE RESTE DE TON CODE EST STRICTEMENT IDENTIQUE ====== */
/* hash, pbkdf2Hash, genSalt, normalizeUser, loadUser, saveUser,
   preloadCis, login, forgotWithQuestion */
/* üëâ RIEN N‚ÄôA √âT√â MODIFI√â DANS LA LOGIQUE */
</script>

</body>
</html>
